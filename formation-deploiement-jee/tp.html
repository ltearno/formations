<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Arnaud Tournier">
<title>Déploiement Java EE - Travaux pratiques</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Déploiement Java EE - Travaux pratiques</h1>
<div class="details">
<span id="author" class="author">Arnaud Tournier</span><br>
<span id="email" class="email"><a href="mailto:ltearno@gmail.com">ltearno@gmail.com</a></span><br>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>IUT Blagnac LP APSIO - 2021 - LTE Consulting</p>
</div>
<div class="paragraph">
<p>Exercices liés au déploiement d&#8217;application Java EE.
Les principes mis en oeuvre ne sont pas spécifiques à Java EE mais y sont fortement adaptés.</p>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title">Plan des exercices</div>
<ul class="sectlevel1">
<li><a href="#_exercice_1_création_dune_application_java_ee_très_simple">Exercice 1 : création d&#8217;une application Java EE très simple</a>
<ul class="sectlevel2">
<li><a href="#_outils_de_développement">Outils de développement</a></li>
<li><a href="#_télécharger_tomcat">Télécharger Tomcat</a></li>
<li><a href="#_télécharger_maven">Télécharger Maven</a></li>
<li><a href="#_extraire_maven_et_son_installation">Extraire Maven et son installation</a></li>
<li><a href="#_compilation_du_squelette_de_projet_java_ee_maven">Compilation du squelette de projet Java EE Maven</a></li>
<li><a href="#_déploiement_de_lapplication_dans_tomcat">Déploiement de l&#8217;application dans Tomcat</a></li>
<li><a href="#_lancement_de_tomcat">Lancement de Tomcat</a></li>
<li><a href="#_accéder_à_lapplication_avec_votre_navigateur">Accéder à l&#8217;application avec votre navigateur.</a></li>
<li><a href="#_une_application_à_état_simple">Une application à état (simple)</a></li>
<li><a href="#_comment_effacer_les_cookies">Comment effacer les cookies ?</a></li>
<li><a href="#_ajout_dun_compteur">Ajout d&#8217;un compteur</a></li>
<li><a href="#_comment_fonctionne_le_principe_de_session">Comment fonctionne le principe de session ?</a></li>
<li><a href="#_cycle_de_développement">Cycle de développement</a></li>
<li><a href="#_automatisation">Automatisation</a></li>
<li><a href="#_conclusions">Conclusions</a></li>
</ul>
</li>
<li><a href="#_exercice_2_déployer_lapplication_sur_deux_tomcat_avec_load_balancing">Exercice 2 : déployer l&#8217;application sur deux Tomcat avec load balancing</a>
<ul class="sectlevel2">
<li><a href="#_comment_faire_face_au_problème_de_crash_serveur">Comment faire face au problème de crash serveur ?</a></li>
<li><a href="#_installer_la_seconde_instance_de_tomcat">Installer la seconde instance de Tomcat</a></li>
<li><a href="#_installer_et_configurer_nginx_en_load_balancer">Installer et configurer NGINX en Load Balancer</a></li>
<li><a href="#_au_passage_quels_ont_été_les_freins_à_lautomatisation">Au passage, quels ont été les freins à l&#8217;automatisation ?</a></li>
<li><a href="#_déployer_sur_les_deux_tomcats">Déployer sur les deux Tomcats</a></li>
<li><a href="#_problème_des_sessions">Problème des sessions</a></li>
<li><a href="#_trois_solutions_enisageables">Trois solutions enisageables</a></li>
</ul>
</li>
<li><a href="#_exercice_3_déport_de_la_session_dans_une_base_externe">Exercice 3 : Déport de la session dans une base externe</a>
<ul class="sectlevel2">
<li><a href="#_préparation_de_mysql">Préparation de MySQL</a></li>
<li><a href="#_paramétrage_de_tomcat">Paramétrage de Tomcat</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#_exercice_4_utilisation_de_jwt">Exercice 4 : Utilisation de JWT</a></li>
<li><a href="#_exercice_5_stockage_dune_information_de_session_dans_un_jeton_jwt">Exercice 5 : stockage d&#8217;une information de session dans un jeton JWT</a>
<ul class="sectlevel2">
<li><a href="#_et_la_sécurité">Et la sécurité ?</a></li>
<li><a href="#_conclusion_2">Conclusion</a></li>
</ul>
</li>
<li><a href="#_exercice_6_déploiement_de_lapplication_avec_docker">Exercice 6 : Déploiement de l&#8217;application avec Docker.</a>
<ul class="sectlevel2">
<li><a href="#_installation_de_docker">Installation de Docker</a></li>
</ul>
</li>
<li><a href="#_exercice_7_gérer_notre_application_avec_kubernetes">Exercice 7 : Gérer notre application avec Kubernetes</a>
<ul class="sectlevel2">
<li><a href="#_installation_et_création_dun_cluster_de_développement">Installation et création d&#8217;un cluster de développement</a></li>
<li><a href="#_exécution_de_lapplication">Exécution de l&#8217;application</a></li>
</ul>
</li>
<li><a href="#_exercice_8_utilisation_de_jmeter_pour_analyser_les_stratégies_de_déploiement">Exercice 8 : Utilisation de <code>JMeter</code> pour analyser les stratégies de déploiement</a></li>
<li><a href="#_bilan">Bilan</a></li>
<li><a href="#_barême">Barême</a></li>
<li><a href="#_troubleshooting_problèmes_courants">Troubleshooting / Problèmes courants</a>
<ul class="sectlevel2">
<li><a href="#_sous_eclipse_une_erreur_dans_un_fichier_jsp_javax_servlet_httpservletrequest_has_not_been_found_in_the_java_build_path">Sous Eclipse, une erreur dans un fichier .jsp : "javax.servlet.HttpServletRequest has not been found in the Java Build Path"</a></li>
<li><a href="#_jre_home_java_home_nest_pas_défini"><code>JRE_HOME</code> / <code>JAVA_HOME</code> n&#8217;est pas défini</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_1_création_dune_application_java_ee_très_simple">Exercice 1 : création d&#8217;une application Java EE très simple</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_outils_de_développement">Outils de développement</h3>
<div class="paragraph">
<p>Vous pouvez utiliser les outils de votre choix (IDE comme Eclipse, IntelliJ, VSCode, ou autre vi, emacs&#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>Si vous choisissez Eclipse, optez pour la variante "Java EE" de façon à profiter des outils Java EE dédiés.</p>
</div>
<div class="paragraph">
<p>Cependant, comme nous nous interressons aux tâches de CI (continuous integration) exécutées par des serveurs, nous ne focalisons pas sur l&#8217;IDE dans ces exercices. Nous allons tout faire en ligne de commande.</p>
</div>
</div>
<div class="sect2">
<h3 id="_télécharger_tomcat">Télécharger Tomcat</h3>
<div class="paragraph">
<p>Télécharger Tomcat en version 8.5.55 et l&#8217;extraire dans un répertoire (faites attention à ce que le chemin du répertoire de tomcat ne contienne pas d&#8217;espace).</p>
</div>
<div class="paragraph">
<p>Lien : <a href="https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.55/bin/apache-tomcat-8.5.55.tar.gz" class="bare">https://archive.apache.org/dist/tomcat/tomcat-8/v8.5.55/bin/apache-tomcat-8.5.55.tar.gz</a> (il existe aussi en zip)</p>
</div>
</div>
<div class="sect2">
<h3 id="_télécharger_maven">Télécharger Maven</h3>
<div class="paragraph">
<p>Maven sera utilisé pour construire le fichier <code>.war</code> qui sera ensuite déployé dans Tomcat.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Lien : <a href="https://maven.apache.org/download.cgi" class="bare">https://maven.apache.org/download.cgi</a></p>
</li>
<li>
<p>Télécharger le fichier <code>apache-maven-3.8.1-bin.zip</code> (ou <code>.tar.gz</code>)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_extraire_maven_et_son_installation">Extraire Maven et son installation</h3>
<div class="paragraph">
<p>Extraire le fichier zip dans un répertoire de votre choix (sous Windows, n&#8217;utilisez pas le répertoire <code>Program Files</code>).</p>
</div>
<div class="paragraph">
<p>Ajouter le répertoire <code>VOTRE_REPERTOIRE/apache-maven-3.5.3-bin/bin</code> dans la variable d&#8217;environnement <code>PATH</code>.</p>
</div>
<div class="paragraph">
<p>Pour vérifier, vous devez pouvoir lancer <code>mvn -v</code>, maven imprimera sa version à l&#8217;écran, comme ceci :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ mvn -v
Apache Maven 3.8.1 (05c21c65bdfed0f71a2f2ada8b84da59348c4c5d)
Maven home: /.../formation-deploiement-jee/tp/etape-01/apache-maven-3.8.1
Java version: 11.0.11, vendor: Ubuntu, runtime: /usr/lib/jvm/java-11-openjdk-amd64
Default locale: fr_FR, platform encoding: UTF-8
OS name: "linux", version: "5.8.0-53-generic", arch: "amd64", family: "unix"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compilation_du_squelette_de_projet_java_ee_maven">Compilation du squelette de projet Java EE Maven</h3>
<div class="paragraph">
<p>Télécharger <a href="http://rezil.io:8080/squelette-tp.zip" class="bare">http://rezil.io:8080/squelette-tp.zip</a> c&#8217;est un squelette de projet de type <em>hello world</em>.</p>
</div>
<div class="paragraph">
<p>Aller dans le répertoire d&#8217;extraction</p>
</div>
<div class="paragraph">
<p>Taper <code>mvn install</code></p>
</div>
<div class="paragraph">
<p>Normalement il télécharge plein de choses (la première fois), puis il finit par un message <em>success</em>.</p>
</div>
<div class="paragraph">
<p>Maven a construit le fichier <code>.war</code> contenant toutes les informations dont Tomcat a besoin pour exécuter notre application. Ce fichier <code>.war</code> se trouve
dans le sous répertoire <code>target</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_déploiement_de_lapplication_dans_tomcat">Déploiement de l&#8217;application dans Tomcat</h3>
<div class="paragraph">
<p>Pour déployer l&#8217;application dans le serveur Tomcat, vous copiez le fichier <code>target/tp-deploiement-1.0-SNAPSHOT.war</code> dans
le sous-répertoire <code>webapps</code> de l&#8217;installation de Tomcat, que l&#8217;on appelle également le répertoire de déploiement.</p>
</div>
<div class="paragraph">
<p>A chaque fois que vous copierez une nouvelle version du <code>war</code> dans le répertoire de
déploiement de Tomcat, celui-ci relance l&#8217;application (c&#8217;est le comportement par défaut, il est configurable).</p>
</div>
</div>
<div class="sect2">
<h3 id="_lancement_de_tomcat">Lancement de Tomcat</h3>
<div class="paragraph">
<p>Lancez Tomcat depuis le répertoire <code>bin/</code> de Tomcat avec le script <code>startup.sh</code> (si vous êtes dans un bash CygWIN ou MinGW, sinon utilisez la
version Windows Batch (<code>.bat</code>)).</p>
</div>
<div class="paragraph">
<p>Le programme indique que Tomcat est lancé. Par défaut il répondra avec le protocole HTTP sur le port 8080.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accéder_à_lapplication_avec_votre_navigateur">Accéder à l&#8217;application avec votre navigateur.</h3>
<div class="paragraph">
<p>Vous devez pouvoir accéder à l&#8217;adresse <code><a href="http://localhost:8080/tp-deploiement-1.0-SNAPSHOT/" class="bare">http://localhost:8080/tp-deploiement-1.0-SNAPSHOT/</a></code> dans un navigateur.</p>
</div>
<div class="paragraph">
<p>Normalement, la page s&#8217;affichant dans le navigateur correspond à l&#8217;exécution du fichier <code>index.jsp</code>.</p>
</div>
<div class="paragraph">
<p>C&#8217;est une application vraiment simple (qui ne possède aucun état).</p>
</div>
<div class="paragraph">
<p>Cette application affiche la propriété <code>catalina.base</code> qui reflète le répertoire d&#8217;installation de Tomcat.
Cette information nous sera utile quand nous déploierons de multiples instances de Tomcat pour gérer la haute-disponibilité.</p>
</div>
</div>
<div class="sect2">
<h3 id="_une_application_à_état_simple">Une application à état (simple)</h3>
<div class="paragraph">
<p>Maintenant, c&#8217;est à vous de continuer le développement en codant !</p>
</div>
<div class="paragraph">
<p>Nous allons introduire un état conversationnel entre l&#8217;utilisateur et l&#8217;application, de façon à pouvoir étudier ensuite ce qu&#8217;il se
produira lorsque nous voudrons ajouter des fonctionalités d&#8217;élasticité et de haute disponibilité à celle-ci.</p>
</div>
<div class="paragraph">
<p>Une application, même des plus simple, a très souvent besoin de stocker l&#8217;état conversationnel entre elle et chacun de ses clients : c&#8217;est ce que l&#8217;on nomme en général la <strong>session</strong>.
Il s&#8217;agit souvent de l'<em>utilisateur connecté</em> ou encore du <em>panier d&#8217;achats</em> dans le cas d&#8217;un site de commerce.</p>
</div>
<div class="paragraph">
<p>La façon la plus courante d&#8217;implémenter ce mécanisme fait appel aux cookies et à un espace mémoire dans l&#8217;application. Lorsque le navigateur fait sa première requête au serveur, celui-ci
ajoute dans sa réponse http un header spécial <code>Set-Cookie</code> contenant une valeur aléatoire générée par l&#8217;application et seulement connue d&#8217;elle. L&#8217;application stocke ensuite dans une mémoire
associative (hash map ou table sql par exemple) l&#8217;association entre le nombre aléatoire et les informations de sessions, qui seront mises à jour au fur et à mesure du dialogue avec l&#8217;utilisateur.</p>
</div>
<div class="paragraph">
<p>Le protocole http stipule que le navigateur doit à partir de ce moment, toujours inclure ce <em>cookie</em> dans les requêtes qu&#8217;il envoie à notre serveur (il fait cela en ajoutant aux requêtes un header <code>Cookie</code> correspondant). Ainsi dans le traitement des requêtes
suivantes, le serveur peut retrouver dans la mémoire associative les données associées à son dialogue avec l&#8217;utilisateur.</p>
</div>
<div class="paragraph">
<p>C&#8217;est ainsi que l&#8217;application peut faire le lien entre les différentes requêtes d&#8217;un utilisateur, et se souvenir par exemple, qu&#8217;il est correctement authentifié ou pas. Sans ce mécanisme, il faudrait
resaisir son login et mot de passe à chaque requête ! Il est assez sécurisé car le nombre étant aléatoire et secret, il sera impossible à deviner par un attaquant (pourvu qu&#8217;il soit grand,
vraiment aléatoire et qu&#8217;on protège notre application par du <em>rate limiting</em>).</p>
</div>
<div class="paragraph">
<p>La norme Java EE fournit un mécanisme de HttpSession fonctionnant de cette façon (vous pouvez voir le cookie <code>JSESSIONID</code> dans les requêtes de votre navigateur vers des applications servies par Tomcat).
Nous allons dans l&#8217;exercice suivant utiliser ces fonctionalités offertes, mais aussi manipuler nous-mêmes un cookie, de façon à bien comprendre le mécanisme.</p>
</div>
<div class="paragraph">
<p>Notons au passage que par défaut, Tomcat stocke les données de session en mémoire vive et les vide sur disque en cas de plantage.</p>
</div>
<div class="paragraph">
<p>Nous allons introduire un état dans l&#8217;application en utilisant la session utilisateur et un cookie.</p>
</div>
<div class="paragraph">
<p>Notre application restera extrêmement simple, afin de nous concentrer sur les notions qui nous interressent. Elle ne contiendra qu&#8217;une seule page qui affiche :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>l&#8217;identifiant technique du serveur (obtenu avec la méthode <code>ManagementFactory.getRuntimeMXBean().getName()</code>),</p>
</li>
<li>
<p>le répertoire de déploiement de l&#8217;instance Tomcat (obtenu grâce à <code>System.getProperty("catalina.base")</code>),</p>
</li>
<li>
<p>l&#8217;identifiant de session (<code>session.getId()</code>, <code>session</code> étant obtenu à partir de l&#8217;objet <code>HttpRequest</code> venant du serveur d&#8217;application),</p>
</li>
<li>
<p>une chaine de caractère provenant du cookie <code>MONCOOKIE</code> que l&#8217;on trouve dans la requête HttpRequest du client. Si le client n&#8217;apporte pas de cookie, l&#8217;application devra générer une chaine aléatoire et demander au navigateur de la stocker comme cookie <code>MONCOOKIE</code> (on utilisera <code>response.setCookie(&#8230;&#8203;)</code>).</p>
</li>
<li>
<p>une chaine de caractère stockée dans la session et générée la première fois que la page est vue au cours d&#8217;une session,</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Implémentez la page en modifiant le fichier <code>index.jsp</code> du projet squelette (si vous partez du projet squelette, mais ce n&#8217;est pas obligatoire). Vous pouvez bien sûr ajouter vos propres classes, faites comme vous l&#8217;entendez.</p>
</div>
<div class="paragraph">
<p>Déployez et vérifiez que l&#8217;application fonctionne.</p>
</div>
<div class="paragraph">
<p>A la première connexion la page doit afficher une valeur de session nulle, puis cette valeur est
valorisée et stable au fur et à mesure des rafraichissements. Il en va de même pour la valeur issue du cookie.
C&#8217;est le comportement attendu d&#8217;une telle application.</p>
</div>
<div class="paragraph">
<p>Voici un exemple de rendu :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tp-etape-01.png" alt="tp etape 01">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_comment_effacer_les_cookies">Comment effacer les cookies ?</h3>
<div class="paragraph">
<p>Pour repartir de zéro sans cookie et un session vide, il suffit de supprimer tous les cookies associés à <code>localhost</code> dans votre navigateur, avec les outils de développement.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ajout_dun_compteur">Ajout d&#8217;un compteur</h3>
<div class="paragraph">
<p>Ajoutez maintenant le code nécessaire pour qu&#8217;un compteur s&#8217;affiche sur la page.</p>
</div>
<div class="paragraph">
<p>Ce compteur doit compter uniquement le nombre d&#8217;affichages particulier à chaque session. Par exemple, si
votre utilisateur ouvre un onglet avec navigation privée, le compteur doit repartir de zéro.</p>
</div>
</div>
<div class="sect2">
<h3 id="_comment_fonctionne_le_principe_de_session">Comment fonctionne le principe de session ?</h3>
<div class="paragraph">
<p>Expliquez le mécanisme associé aux sessions (c&#8217;est un mécanisme universel que vous retrouverez partout, identique à celui de PHP par exemple).</p>
</div>
</div>
<div class="sect2">
<h3 id="_cycle_de_développement">Cycle de développement</h3>
<div class="paragraph">
<p><strong>ATTENTION, Tomcat ne doit pas être lancé avec Eclipse</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>coder dans Eclipse ou autre éditeur/IDE, sauvegarder</p>
</li>
<li>
<p>en ligne de commande dans le projet : <code>mvn install</code></p>
</li>
<li>
<p>copie du <code>target/XXXX.war</code> dans le répertoire de déploiement de Tomcat</p>
</li>
<li>
<p>actualisation dans le navigateur</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_automatisation">Automatisation</h3>
<div class="paragraph">
<p>Maintenant écrivez des scripts pour ne pas avoir à retaper les tâches manuelles répétitives (qui sont d&#8217;ailleurs très souvent source d&#8217;erreur).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>construction du war (simple appel à <code>mvn install</code>)</p>
</li>
<li>
<p>copie du war dans le répertoire de Tomcat</p>
</li>
<li>
<p>lancement de Tomcat.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_conclusions">Conclusions</h3>
<div class="paragraph">
<p>La mise en oeuvre est très simple !</p>
</div>
<div class="paragraph">
<p>Mais quels sont les problèmes ?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Crash serveur = arrêt du service</p>
</li>
<li>
<p>Montée de version = arrêt du service</p>
</li>
<li>
<p>Montée en charge (ok, si on peut fixer le nombre d&#8217;utilisateurs à l&#8217;avance).</p>
</li>
<li>
<p>et bien d&#8217;autres, lesquels ?</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_2_déployer_lapplication_sur_deux_tomcat_avec_load_balancing">Exercice 2 : déployer l&#8217;application sur deux Tomcat avec load balancing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous allons voir par la pratique comment les différentes façons de déployer notre application en cluster
impactent son fonctionnement.</p>
</div>
<div class="sect2">
<h3 id="_comment_faire_face_au_problème_de_crash_serveur">Comment faire face au problème de crash serveur ?</h3>
<div class="paragraph">
<p>Un crash serveur, c&#8217;est un service inaccessible pour le client, et c&#8217;est donc en général une perte d&#8217;argent pour l&#8217;entreprise.
Nous allons maintenant utiliser plusieurs serveurs (de préférences à différents points géographiques pour mitiger les risques
de catastrophes naturelles). Un serveur frontal va router les requêtes http vers nos différents serveurs d&#8217;application.
C&#8217;est le Load Balancer, il répartit les requêtes entrantes sur les serveurs d&#8217;application.</p>
</div>
<div class="paragraph">
<p>Nous allons installer un deuxième serveur Tomcat et NGINX configuré en Load balancer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installer_la_seconde_instance_de_tomcat">Installer la seconde instance de Tomcat</h3>
<div class="paragraph">
<p>Dupliquez l&#8217;installation de Tomcat dans un autre répertoire de votre choix.</p>
</div>
<div class="paragraph">
<p>Editez le ficher <code>server.xml</code> de la deuxième installation et changez les ports de cette façon :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP : 8081</p>
</li>
<li>
<p>Redirection : 8444</p>
</li>
<li>
<p>AJP : 8010</p>
</li>
<li>
<p>Shutdown port : 8006</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Déployer l&#8217;application précédente sur les <strong>deux</strong> serveurs Tomcat.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>On peut faire un lien symbolique du war crée avec maven vers les répertoire de déploiement des Tomcat, ceci vous évitera des opérations répétitives !
Ceci se fait avec la commande <code>ln</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">ln -s cible nom_du_lien</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Dans deux terminaux différents, lancez chacun des Tomcat.</p>
</div>
<div class="paragraph">
<p>Vérifiez dans un navigateur que les deux Tomcat sont lancés sur les ports 8080 et 8081 et que l&#8217;application est bien déployée sur les deux serveurs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installer_et_configurer_nginx_en_load_balancer">Installer et configurer NGINX en Load Balancer</h3>
<div class="paragraph">
<p>Passons à l&#8217;installation du répartiteur de charge <code>nginx</code>.</p>
</div>
<div class="sect3">
<h4 id="_sous_linux_famille_debianubuntu">Sous Linux, famille Debian/Ubuntu</h4>
<div class="paragraph">
<p>Tapez la commande suivante pour installer <code>nginx</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>apt install nginx-full</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sous_windows">Sous Windows</h4>
<div class="paragraph">
<p>Téléchargez l&#8217;archive de NGINX <a href="http://nginx.org/download/nginx-1.10.1.zip">ici</a>.</p>
</div>
<div class="paragraph">
<p>Il faut ensuite l&#8217;extraire, de préférence à la racine d&#8217;un disque.</p>
</div>
<div class="paragraph">
<p>Configurez NGINX en Load Balancer avec la configuration suivante dans <code>/etc/nginx/nginx.conf</code> (sous Windows : <code>conf\nginx.conf</code>) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>http {
	# déclaration des backends
	upstream application {
		# premiere instance de Tomcat
		server 127.0.0.1:8080;
		# deuxième instance de Tomcat
		server 127.0.0.1:8081;
	}

	# configuration du serveur Web
	server {
		# Nginx écoutera sur le port 80 (par défaut en HTTP)
		listen 80;

		# toutes les URLs sont redirigées vers nos deux backends Tomcat
		location / {
			# référence à la partie upstream de la configuration
			proxy_pass http://application;
			# temps avant de considérer un backend comme défaillant
			proxy_connect_timeout 1;
		}
	}
}

events {
	# nombre de connexions simultanées
	worker_connections 768;
}</pre>
</div>
</div>
<div class="paragraph">
<p>Lancez nginx (<code>sudo service nginx start</code>, ou <code>nginx.exe</code> sous Windows) et vérifiez que celui ce fonctionne (le processus est présent et actif, le port 80 est ouvert, vérifier les logs de nginx sinon).
Nginx doit rediriger les requêtes sur le port 80 vers les tomcats (écoutant sur les ports 8080 et 8081).</p>
</div>
<div class="paragraph">
<p>Le serveur nginx répond sur le port 80, il faut donc adapter l&#8217;url dans le navigateur. Rechargez plusieurs fois la page pour vérifier que le load balancing se fait bien alternativement entre les deux serveurs (le répertoire de déploiement affiché doit changer une fois sur deux).</p>
</div>
<div class="paragraph">
<p>Tuez un des deux serveurs :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on recherche le bon processus Tomcat avec <code>ps -Af | grep java</code>,</p>
</li>
<li>
<p>puis on le tue avec <code>kill ID_PROCESSUS</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Sous Windows, utilisez l&#8217;utilitaire approprié pour repérer et tuer le processus, par exemple <code>Process Explorer</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On peut également utiliser le script <code>shutdown.sh</code> (ou <code>shutdown.bat</code> sous Windows) dans le répertoire de Tomcat pour tuer le processus de la façon recommandée (mais cela correspond moins à une panne intempestive que l&#8217;on souhaite simuler).</p>
</div>
<div class="paragraph">
<p>Vérifier que l&#8217;application fonctionne toujours quand on y accède par nginx.</p>
</div>
<div class="paragraph">
<p><strong>Nginx détecte l&#8217;erreur sur le serveur arrêté et poursuit sur le serveur qui fonctionne.</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_au_passage_quels_ont_été_les_freins_à_lautomatisation">Au passage, quels ont été les freins à l&#8217;automatisation ?</h3>
<div class="ulist">
<ul>
<li>
<p>Copie du fichier <code>.war</code> à la main, difficilement automatisable.</p>
</li>
<li>
<p>Lancement et arrêt des serveurs manuel.</p>
</li>
<li>
<p>Et en plus, les sources ne sont pas versionnées !</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour gagner du temps les prochaines fois, créez vous les scripts nécessaires au déploiement de l&#8217;application (copie du <code>.war</code>) et
aux démarrage et arrêt des serveurs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_déployer_sur_les_deux_tomcats">Déployer sur les deux Tomcats</h3>
<div class="paragraph">
<p>Vous constatez certainement un problème. En effet la gestion des sessions faite par Tomcat est perturbée par
le fait que l&#8217;on ai distribué et réparti l&#8217;application sur deux serveurs. La session est stockée localement par
serveur Tomcat donc on a en fait deux sessions stockées sur deux serveurs différents. A chaque fois le Tomcat
qui exécute la requête ne trouve pas la session puisqu&#8217;il s&#8217;agit en fait de l&#8217;identificateur produit par l&#8217;autre Tomcat
(Java EE se base sur le cookie <code>JSESSIONID</code> pour retrouver la session)&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_problème_des_sessions">Problème des sessions</h3>
<div class="paragraph">
<p>Java EE ne prévoit pas de façon standardisée le stockage des sessions en environnement distribué. Chaque serveur d&#8217;application fournit sa propre solution.</p>
</div>
<div class="paragraph">
<p>En standard Java EE prévoit que les données de session soient stokées relativement au serveur qui s&#8217;exécute.</p>
</div>
</div>
<div class="sect2">
<h3 id="_trois_solutions_enisageables">Trois solutions enisageables</h3>
<div class="ulist">
<ul>
<li>
<p>Faire du sticky session. Nginx peut être configuré pour envoyer les clients sur le même serveur.</p>
</li>
<li>
<p>Stocker la session dans une même base de donnée pour tous les serveurs.</p>
</li>
<li>
<p>Utiliser JWT pour envoyer nos informations de "session" à partir du client. L&#8217;information est chifrée dans un cookie qui est transmis par le navigateur et qui reste le même quelque soit le client.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_sticky_load_balancer">Sticky load balancer</h4>
<div class="paragraph">
<p>Le Load Balancer (Nginx) calcule un hash basé sur l&#8217;adresse IP du client et route la requête vers le serveur correspondant. Une même IP cliente est donc toujours routée vers la même instance du backend.</p>
</div>
<div class="paragraph">
<p>Rajouter <code>ip_hash;</code> dans la section <code>upstream</code> de la configuration de Nginx.</p>
</div>
<div class="paragraph">
<p>Relancer Nginx.</p>
</div>
<div class="paragraph">
<p>Constater que maintenant la session est stable.</p>
</div>
<div class="paragraph">
<p>Mais si on arrête le serveur choisi par Nginx, que se passe-t-il ?</p>
</div>
<div class="paragraph">
<p>On perd la session quand le serveur crashe ! Donc l&#8217;utilisateur connecté, son panier etc&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>AVANTAGE :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on ne peut pas faire plus simple ! Et l&#8217;application survit bien au crash d&#8217;un de ses serveurs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>INCONVENIENTS :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mauvaise répartition de la charge.</p>
</li>
<li>
<p>Quand un des serveurs crashe on perd les sessions de tous les utilisateurs qui y étaient connectés. Pas très bon pour les affaires&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pour les détails de la configuration de Nginx en load balancer, on peut se référer à cette page : <a href="http://nginx.org/en/docs/http/load_balancing.html" class="bare">http://nginx.org/en/docs/http/load_balancing.html</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_3_déport_de_la_session_dans_une_base_externe">Exercice 3 : Déport de la session dans une base externe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le phénomène de perte de session précédent est l&#8217;effet du fonctionnement interne du serveur d&#8217;application Java EE.</p>
</div>
<div class="paragraph">
<p>Pour le résoudre, on déporte le stockage des données de session (l'"état" de l&#8217;application à chaque requête) à l&#8217;extérieur des serveurs d&#8217;application Java EE.</p>
</div>
<div class="paragraph">
<p>On peut soit utiliser des solutions de clustering propre à chaque distributeur (JBoss, WebLogic, &#8230;&#8203;).</p>
</div>
<div class="paragraph">
<p>Ou bien implémenter sa propre solution, afin de comprendre les mécanismes en jeu.</p>
</div>
<div class="paragraph">
<p>Nous allons utiliser une solution simple proposée en standard par Apache Tomcat : le stockage des sessions dans une base de donnée MySQL.</p>
</div>
<div class="paragraph">
<p>Retirer <code>ip_hash;</code> de la configuration de Nginx et redémarrer celui-ci.</p>
</div>
<div class="sect2">
<h3 id="_préparation_de_mysql">Préparation de MySQL</h3>
<div class="paragraph">
<p>On va utiliser MySQL, mais il est plus intéressant dans un contexte distribué d&#8217;utiliser une base de données distribuée (Hazelcast, Redis, Memcached, CouchDB ou autre&#8230;&#8203;)</p>
</div>
<div class="paragraph">
<p>Installer MariaDB, une version open source 100% compatible avec MySQL :</p>
</div>
<div class="sect3">
<h4 id="_sous_linux">Sous Linux</h4>
<div class="literalblock">
<div class="content">
<pre>apt install mariadb-server</pre>
</div>
</div>
<div class="paragraph">
<p>Ne pas donner de mot de passe.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sous_windows_2">Sous Windows</h4>
<div class="paragraph">
<p>Sous Windows une façon simple d&#8217;installer MySQL est d&#8217;installer <a href="http://www.wampserver.com/">WAMP</a> puis de ne démarrer que le serveur MySQL (on ne démarre pas Apache).</p>
</div>
<div class="paragraph">
<p>Ensuite on crée la base de donnée et la table qui va stocker les données de session pour les serveurs Tomcat :</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Sous Windows, on peut utiliser PhpMyAdmin pour exécuter des instructions SQL. PhpMyAdmin est installé par défaut avec WAMP.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_création_de_lutilisateur_tomcat">Création de l&#8217;utilisateur <code>tomcat</code></h4>
<div class="paragraph">
<p>Créez un utilisateur <code>tomcat</code> dans le serveur MySQL. Cet utilisateur sera utilisé pour connecter le serveur Tomcat à la base de données.</p>
</div>
<div class="sect4">
<h5 id="_création_de_la_base_de_données_des_sessions">Création de la base de données des sessions</h5>
<div class="listingblock">
<div class="content">
<pre>create database tomcat_sessions;

use tomcat_sessions;

create table tomcat_sessions (
  session_id     varchar(100) not null primary key,
  valid_session  char(1) not null,
  max_inactive   int not null,
  last_access    bigint not null,
  app_name       varchar(255),
  session_data   mediumblob,
  KEY kapp_name(app_name)
);</pre>
</div>
</div>
<div class="paragraph">
<p>Donnez à l&#8217;utilisateur <code>tomcat</code> tous les droits d&#8217;accès en lecture et d&#8217;écriture à la base <code>tomcat_sessions</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_paramétrage_de_tomcat">Paramétrage de Tomcat</h3>
<div class="paragraph">
<p>Télécharger le connecteur JDBC pour MySQL qui est requis pour que Tomcat puisse accéder à la base de données.</p>
</div>
<div class="paragraph">
<p>Le fichier JAR est disponible à cette adresse : <a href="https://search.maven.org/remotecontent?filepath=mysql/mysql-connector-java/5.1.47/mysql-connector-java-5.1.47.jar" class="bare">https://search.maven.org/remotecontent?filepath=mysql/mysql-connector-java/5.1.47/mysql-connector-java-5.1.47.jar</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Pour trouver l&#8217;adresse du fichier jar lorsqu&#8217;une nouvelle version sera sortie, on pourra utiliser cette <a href="http://search.maven.org">url</a> et rechercher l&#8217;artéfact <code>mysql:mysql-connector-java</code> pour télécharger le connecteur JDBC pour MySql. Il faudra prendre la dernière <code>5.1.x</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Copier le connecteur MySql dans le répertoire lib des deux tomcats :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cp mysql-connector-java-5.1.47.jar REPERTOIRE_DU_PREMIER_TOMCAT/lib/
cp mysql-connector-java-5.1.47.jar REPERTOIRE_DU_DEUXIEME_TOMCAT/lib/</pre>
</div>
</div>
<div class="paragraph">
<p>Créer un fichier de contexte pour l&#8217;application, de façon à spécifier au serveur d&#8217;application (Tomcat) que l&#8217;on désire stocker les sessions à l&#8217;extérieur sur une base de donnée. Le fichier à créer est <code>src/main/webapp/META-INF/context.xml</code> pour un projet Maven, et dans <code>WebContent/META-INF/context.xml</code>.</p>
</div>
<div class="paragraph">
<p>Voici le contenu de ce fichier :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;Context&gt;
	&lt;Valve className="org.apache.catalina.valves.PersistentValve"/&gt; <b class="conum">(1)</b>

	&lt;Manager className="org.apache.catalina.session.PersistentManager" &gt; <b class="conum">(2)</b>
		&lt;Store
			className="org.apache.catalina.session.JDBCStore" <b class="conum">(3)</b>
			connectionURL="jdbc:mysql://localhost/tomcat_sessions?user=root" <b class="conum">(4)</b>
			driverName="com.mysql.jdbc.Driver"
			sessionAppCol="app_name"
			sessionDataCol="session_data"
			sessionIdCol="session_id"
			sessionLastAccessedCol="last_access"
			sessionMaxInactiveCol="max_inactive"
			sessionTable="tomcat_sessions" <b class="conum">(5)</b>
			sessionValidCol="valid_session" /&gt;
	&lt;/Manager&gt;
&lt;/Context&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>utilisation du stockage à chaque session</p>
</li>
<li>
<p>utilisation du composant de persistance des sessions</p>
</li>
<li>
<p>utilisation du stockage par JDBC (implémentation de <code>org.apache.catalina.Store</code>)</p>
</li>
<li>
<p>url JDBC de connexion à la bdd des sessions</p>
</li>
<li>
<p>nom de la table utilisée pour le stockage les sessions</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Construire le projet (<code>mvn install</code> avec Maven, ou exporter un WAR avec Eclipse) et le déployer sur les deux Tomcats. Vérifier que Nginx est toujours actif.</p>
</div>
<div class="paragraph">
<p>Rafraîchir la page, que se passe-t-il ?</p>
</div>
<div class="paragraph">
<p>La session reste stable même si le serveur d&#8217;application sollicité change.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>AVANTAGES:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>compatible Java EE, l&#8217;utilisation de l&#8217;API des sessions ne change pas</p>
</li>
<li>
<p>le load balancer est libre de choisir le serveur le plus adapté à la charge actuelle de l&#8217;infrastructure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>INCONVENIENTS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>une connexion (ou pas) à la base de données à chaque requête.</p>
</li>
<li>
<p>crée un goulot d&#8217;étranglement vers la base de données.</p>
</li>
<li>
<p>mais on peut utiliser une base distribuée.</p>
</li>
<li>
<p>on a un serveur de base de donnée à gérer en plus !</p>
</li>
<li>
<p>les resources ne sont pas forcément bien gérées non plus : on va avoir tendance à ne pas remplir les serveurs ce qui empêche de les mettre à l&#8217;arrêt&#8230;&#8203; Solution : remettre les sticky-sessions pour avoir le meilleur des deux mondes.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_4_utilisation_de_jwt">Exercice 4 : Utilisation de JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Il est possible de déporter les données de sessions directement dans le navigateur des utilisateur, et ce de manière sécurisée !</p>
</div>
<div class="paragraph">
<p>Pour cela on chiffre les données sur le serveur avec une clée privée (donc secrète) et on positionne le résultat du chiffrement dans un cookie.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Il est également possible de simplement <em>signer</em> les informations de session. Elles seront lisibles par l&#8217;utilisateur mais il ne pourra pas les modifier sans passer inaperçu.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Au traitement des requêtes suivantes, il suffit de déchiffrer le cookie pour retrouver l&#8217;information et s&#8217;assurer de leur non-altération.</p>
</div>
<div class="paragraph">
<p>Une spécification existe, c&#8217;est JWT (Json Web Token).</p>
</div>
<div class="paragraph">
<p>Nous allons utiliser JJWT, une bibliothèque open source pour la gestion de JWT :</p>
</div>
<div class="paragraph">
<p>Pour un projet utilisant Maven, vous pouvez simplement ajouter ce bout de XML dans le fichier <code>pom.xml</code> dans le noeud <code>dependencies</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
	&lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
	&lt;artifactId&gt;jjwt&lt;/artifactId&gt;
	&lt;version&gt;0.6.0&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Pour un projet n&#8217;utilisant pas Maven, vous pouvez télécharger le fichier jar en allant sur <a href="http://search.maven.org">maven central</a> et en recherchant l&#8217;artéfact <code>jjwt</code>. Le fichier jar est disponible en cliquant sur le lien <code>jar</code> qui doit apparaitre en résultat de recherche. Ce fichier sera à copier dans le répertoire <code>WEB-INF/lib</code> de votre application (à créer si nécessaire).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// chiffrer l'information 'Subject'
String s = Jwts.builder().setSubject("Joe").signWith(SignatureAlgorithm.HS512, key).compact();

// déchiffrer l'information
Jwts.parser().setSigningKey(key).parseClaimsJws(s).getBody().getSubject(); // renvoie "Joe"

// création d'une clé de chiffrement
Key createKey() {
	SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;

	byte[] apiKeySecretBytes = "alja lkejhe kjhdaoiuha ofygfakhfkjhg".getBytes();

	Key key = new SecretKeySpec(apiKeySecretBytes, signatureAlgorithm.getJcaName());

	return key;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_5_stockage_dune_information_de_session_dans_un_jeton_jwt">Exercice 5 : stockage d&#8217;une information de session dans un jeton JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ecrivez maintenant le code nécessaire pour stocker dans le jeton JWT le <em>pseudo</em> de l&#8217;utilisateur.</p>
</div>
<div class="paragraph">
<p>A cette fin, vous aurez à écrire un formulaire web permettant à l&#8217;utilisateur de saisir son pseudo. La page d&#8217;accueil devra ensuite afficher ce pseudo, contenu dans le jeton JWT.</p>
</div>
<div class="paragraph">
<p>AVANTAGES:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>l&#8217;état est conservé côté client, ce qui allège considérablement la charge serveur.</p>
</li>
<li>
<p>permet une infrastructure réellement stateless</p>
</li>
<li>
<p>sécurisé</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>INCONVENIENTS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>le chiffrement peut être couteux et nécessiter du métériel dédié</p>
</li>
<li>
<p>le stockage et la gestion des clés privés peut être problématique</p>
</li>
<li>
<p>impraticable pour stocker des données volumineuses</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_et_la_sécurité">Et la sécurité ?</h3>
<div class="paragraph">
<p>Attention à la gestion des clés avec l&#8217;utilisation de JWT !</p>
</div>
<div class="paragraph">
<p>Pour HTTPS on peut utiliser des machines de chiffrement en bordure de réseau.</p>
</div>
<div class="paragraph">
<p>Ne pas oublier cette dimension qui n&#8217;a été que très peu abordée dans ce cours&#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion_2">Conclusion</h3>
<div class="paragraph">
<p>Toujours une histoire de compromis, il faut choisir le meilleur entre :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>réponse à la demande,</p>
</li>
<li>
<p>complexité de la solution,</p>
</li>
<li>
<p>productivité.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_6_déploiement_de_lapplication_avec_docker">Exercice 6 : Déploiement de l&#8217;application avec Docker.</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation_de_docker">Installation de Docker</h3>
<div class="paragraph">
<p>Voir la <a href="https://docs.docker.com/engine/installation/linux/debian/">documentation officielle</a>&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre># La version noyau doit être supérieur à 3.10
# Le système doit être 64 bits
uname -r

sudo apt-get install docker.io</pre>
</div>
</div>
<div class="paragraph">
<p>Téléchargement de l&#8217;image officielle de Tomcat en version 8.0.35, avec un environnement Java 8 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo docker pull tomcat:8.0.35-jre8</pre>
</div>
</div>
<div class="paragraph">
<p>Nous créons un fichier <code>Dockerfile</code> pour créer une image consistant en :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>l&#8217;image Tomcat que nous venons de télécharger</p>
</li>
<li>
<p>notre application, dans le répertoire de déploiement de Tomcat, à l&#8217;intérieur de l&#8217;image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Voici le contenu du fichier :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM tomcat:8.0.35-jre8 <b class="conum">(1)</b>
COPY target/deploiement-1.0-SNAPSHOT.war /usr/local/tomcat/webapps/ <b class="conum">(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>image officielle de Tomcat pour commencer</p>
</li>
<li>
<p>copie du war de l&#8217;application dans le répertoire de déploiement de Tomcat</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ensuite nous créons effectivement l&#8217;image à partir du <code>Dockerfile</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo docker build -t ltearno/application:latest .

# =&gt; Successfully built a867b1c2e8ae</pre>
</div>
</div>
<div class="paragraph">
<p>Lancez l&#8217;image en intéractif pour voir :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo docker run  -it --rm -p 8080:8080 ltearno/application:latest</pre>
</div>
</div>
<div class="paragraph">
<p>Vous devez voir les logs de Tomcat s&#8217;imprimer à l&#8217;écran jusqu&#8217;au message de fin de démarrage.</p>
</div>
<div class="paragraph">
<p>Comme nous avons indiqué un mappage de port (<code>-p 8080:8080</code>), il est possible d&#8217;accéder à l&#8217;application
à partir de l&#8217;url 'http://localhost:8080'. Vérifiez que cela fonctionne bien.</p>
</div>
<div class="paragraph">
<p>Tuez l&#8217;image avec <code>Ctrl+C</code>.</p>
</div>
<div class="paragraph">
<p>Lancer l&#8217;image dix fois, en mode démon (<code>-d</code>) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo docker run -d -p 8080:8080 ltearno/application:latest
sudo docker run -d -p 8081:8080 ltearno/application:latest
sudo docker run -d -p 8082:8080 ltearno/application:latest
sudo docker run -d -p 8083:8080 ltearno/application:latest
sudo docker run -d -p 8084:8080 ltearno/application:latest
sudo docker run -d -p 8085:8080 ltearno/application:latest
sudo docker run -d -p 8086:8080 ltearno/application:latest
sudo docker run -d -p 8087:8080 ltearno/application:latest
sudo docker run -d -p 8088:8080 ltearno/application:latest
sudo docker run -d -p 8089:8080 ltearno/application:latest</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>On n&#8217;a plus besoin de changer le port d&#8217;écoute de Tomcat dans sa configuration,
ceci est fait <strong>depuis l&#8217;extérieur</strong> de l&#8217;application avec docker.</p>
</div>
<div class="paragraph">
<p>Pour l&#8217;application, l&#8217;exécution s&#8217;effectue dans des environnements strictement
identiques, c&#8217;est un des bénéfices de Docker.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il est possible de consulter la liste des containers :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>arnaud@arnaud-debian:~/deploiement$ docker ps -a
CONTAINER ID        IMAGE                        COMMAND             CREATED             STATUS              PORTS                    NAMES
82fa4257fe41        ltearno/application:latest   "catalina.sh run"   21 seconds ago      Up 21 seconds       0.0.0.0:8089-&gt;8080/tcp   sharp_hodgkin
689bf0375e14        ltearno/application:latest   "catalina.sh run"   24 seconds ago      Up 23 seconds       0.0.0.0:8088-&gt;8080/tcp   berserk_cori
4be52fa3e953        ltearno/application:latest   "catalina.sh run"   24 seconds ago      Up 24 seconds       0.0.0.0:8087-&gt;8080/tcp   angry_colden
fa7d70b4418a        ltearno/application:latest   "catalina.sh run"   25 seconds ago      Up 25 seconds       0.0.0.0:8086-&gt;8080/tcp   mad_leakey
50d31fa22616        ltearno/application:latest   "catalina.sh run"   26 seconds ago      Up 26 seconds       0.0.0.0:8084-&gt;8080/tcp   stupefied_euclid
744666ee4b0b        ltearno/application:latest   "catalina.sh run"   26 seconds ago      Up 25 seconds       0.0.0.0:8085-&gt;8080/tcp   agitated_bohr
62aae97404a7        ltearno/application:latest   "catalina.sh run"   27 seconds ago      Up 27 seconds       0.0.0.0:8083-&gt;8080/tcp   distracted_elion
2bce8ed38ed3        ltearno/application:latest   "catalina.sh run"   28 seconds ago      Up 28 seconds       0.0.0.0:8082-&gt;8080/tcp   distracted_mestorf
b244f8af49fd        ltearno/application:latest   "catalina.sh run"   29 seconds ago      Up 28 seconds       0.0.0.0:8081-&gt;8080/tcp   happy_blackwell
fc285815ea12        ltearno/application:latest   "catalina.sh run"   29 seconds ago      Up 29 seconds       0.0.0.0:8080-&gt;8080/tcp   sharp_kowalevski
arnaud@arnaud-debian:~/deploiement$</pre>
</div>
</div>
<div class="paragraph">
<p>Pour stopper tous les containers :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)</pre>
</div>
</div>
<div class="paragraph">
<p>Editez la configuration Nginx pour prendre en compte les nouveaux ports TCP. Relancer Nginx (<code>sudo nginx -s reload</code>).</p>
</div>
<div class="paragraph">
<p>Avec le navigateur, constater que les dix serveurs Tomcat sont alternativement utilisés.</p>
</div>
<div class="paragraph">
<p>Tuer quelques containers pour constater que l&#8217;application n&#8217;est nullement dérangée.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_7_gérer_notre_application_avec_kubernetes">Exercice 7 : Gérer notre application avec Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voir la <a href="http://kubernetes.io/docs/getting-started-guides/docker/">doc</a> pour commencer.</p>
</div>
<div class="sect2">
<h3 id="_installation_et_création_dun_cluster_de_développement">Installation et création d&#8217;un cluster de développement</h3>
<div class="paragraph">
<p>Dans un environnement de production Kubernetes permet de gérer un cluster de machines physiques ou virtuelles.
Il peut même piloter des services cloud (GCP, AWS, &#8230;&#8203;) pour créer des machines virtuelles et lancer les conteneurs
apprpriés.</p>
</div>
<div class="paragraph">
<p>Ici nous allons installer K8S sur notre machine de développement. Notre cluster sera donc réduit à un noeud.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># choix de la version de Kubernetes
export K8S_VERSION=$(curl -sS https://storage.googleapis.com/kubernetes-release/release/stable.txt)

# lancement de Kubernetes au sein d'un container Docker
export ARCH=amd64
docker run -d \
    --volume=/:/rootfs:ro \
    --volume=/sys:/sys:rw \
    --volume=/var/lib/docker/:/var/lib/docker:rw \
    --volume=/var/lib/kubelet/:/var/lib/kubelet:rw \
    --volume=/var/run:/var/run:rw \
    --net=host \
    --pid=host \
    --privileged \
    gcr.io/google_containers/hyperkube-${ARCH}:${K8S_VERSION} \
    /hyperkube kubelet \
        --containerized \
        --hostname-override=127.0.0.1 \
        --api-servers=http://localhost:8080 \
        --config=/etc/kubernetes/manifests \
        --cluster-dns=10.0.0.10 \
        --cluster-domain=cluster.local \
        --allow-privileged --v=2

# installation de kubectl
sudo bash
curl -sSL "http://storage.googleapis.com/kubernetes-release/release/v1.2.0/bin/linux/amd64/kubectl" &gt; /usr/bin/kubectl
chmod +x /usr/bin/kubectl
exit

# configuration du cluster local
kubectl config set-cluster mon-cluster --server=http://localhost:8080
kubectl config set-context mon-cluster --cluster=mon-cluster
kubectl config use-context mon-cluster

# on vérifie que le tout est bien configuré
kubectl get nodes
# (on doit voir la liste des noeuds, c'est à dire un noeud 127.0.0.1)</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exécution_de_lapplication">Exécution de l&#8217;application</h3>
<div class="paragraph">
<p>Kubernetes est maintenant prêt à recevoir les commandes de création de clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># création et lancement d'un déploiement de l'image nginx
kubectl run nginx --image=nginx --port=80

# on expose ce déploiement sur le port 80
kubectl expose deployment nginx --port=80

# pour obtenir l'adresse exposée par ce déploiement
kubectl get svc nginx --template={{.spec.clusterIP}}</pre>
</div>
</div>
<div class="paragraph">
<p>Tester le serveur Nginx dans sa version standard dans un navigateur puis pour arrêter et effacer ce cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>kubectl delete deployment nginx

# création du pod
kubectl create -f ./application-pod.yaml

# liste des pods
kubectl get pods

kubectl delete pod application</pre>
</div>
</div>
<div class="paragraph">
<p>Ceci termine l&#8217;exercice d&#8217;introduction à Kubernetes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercice_8_utilisation_de_jmeter_pour_analyser_les_stratégies_de_déploiement">Exercice 8 : Utilisation de <code>JMeter</code> pour analyser les stratégies de déploiement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Groupez vous par groupe de 8 personnes.</p>
</div>
<div class="paragraph">
<p>Utilisez :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>une machine avec le load balancer,</p>
</li>
<li>
<p>une machine avec la base de données des sessions,</p>
</li>
<li>
<p>une machine avec <code>JMeter</code>,</p>
</li>
<li>
<p>le reste des machines avec les serveurs d&#8217;application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Lancez un benchmark JMeter pour chacune des stratégies :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>déploiement sur une seule machine,</p>
</li>
<li>
<p>déploiement sur 2, 3 etc&#8230;&#8203; machines.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Analysez le niveau de sollicitation de chaque composant de l&#8217;application distribuée.</p>
</div>
<div class="paragraph">
<p>Pour simuler une application un peu gourmande en CPU, vous pouvez utiliser la méthode suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void spinCPU(long durationInMillisecond){
	long start = System.currentTimeMillis();
	while(System.currentTimeMillis()-start &lt; durationInMillisecond)
		;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Analysez ensuite la résistance des différents déploiements
aux erreurs matérielles comme par exemple extinction brutale d&#8217;un des serveurs d&#8217;application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bilan">Bilan</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Voici les étapes successives réalisées pendant ces travaux pratiques.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Etape</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Création du projet Java EE dans Eclipse</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Affichage du répertoire de déploiement dans <code>index.jsp</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Création du fichier <code>.war</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déploiement du fichier <code>.war</code> dans le répertoire de déploiement de Tomcat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Démarrage de Tomcat en ligne de commande</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arrêt de Tomcat en ligne de commande</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mise en place de la donnée en session (code en plus dans l&#8217;application)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation et configuration d&#8217;un deuxième Tomcat</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation de NGINX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déploiement en mode un LB et deux AP (Application Serveur, les deux Tomcat)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pourquoi les sessions ne sont-elles pas stables ?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration en <em>stocky session</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Installation de MySQL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration des Tomcat pour déporter les sessions en base de données</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mise en place de JWT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stockage du pseudo de l&#8217;utilisateur dans un token JWT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déploiement de l&#8217;application avec Docker (une dizaine d&#8217;instance + NGINX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilisation de <code>Kubernetes</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déploiement sur un vrai cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JMeter</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_barême">Barême</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Mise en place du projet Maven : 1 point</p>
</li>
<li>
<p>Ecriture du code Java / JSP du premier exercice : 1 point</p>
</li>
<li>
<p>Installation et configuration du deuxième Tomcat : 1 point</p>
</li>
<li>
<p>Installation et configuration de Nginx : 1 point</p>
</li>
<li>
<p>Ecriture des scripts d&#8217;automatisation (build maven, copie du war) : 2 points</p>
</li>
<li>
<p>Déploiement en mode Load Balancer avec deux Tomcat : 2 points</p>
</li>
<li>
<p>Configuration des Tomcats pour déporter les sessions en bases de données : 2 points</p>
</li>
<li>
<p>Mise en place des jetons JWT : 2 points</p>
</li>
<li>
<p>Stockage du pseudo de l&#8217;utilisateur dans un token JWT : 2 points</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Total de 14 points ajusté avec une règle de trois pour arriver à une note de 20.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Le QCM sera noté sur 10 points.</p>
</div>
<div class="paragraph">
<p>La somme de ces notes sera ramenée également à une note de 20. Le TP est donc deux fois plus important que le QCM (pour les points).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_troubleshooting_problèmes_courants">Troubleshooting / Problèmes courants</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_sous_eclipse_une_erreur_dans_un_fichier_jsp_javax_servlet_httpservletrequest_has_not_been_found_in_the_java_build_path">Sous Eclipse, une erreur dans un fichier .jsp : "javax.servlet.HttpServletRequest has not been found in the Java Build Path"</h3>
<div class="paragraph">
<p>Ne pas prendre en compte cette erreur, c&#8217;est juste Eclipse qui est à la rue !</p>
</div>
</div>
<div class="sect2">
<h3 id="_jre_home_java_home_nest_pas_défini"><code>JRE_HOME</code> / <code>JAVA_HOME</code> n&#8217;est pas défini</h3>
<div class="paragraph">
<p>En ligne de commande, le démarrage de Tomcat échoue à cause de cette erreur.</p>
</div>
<div class="paragraph">
<p>C&#8217;est avec cette variable que Tomcat détecte le répertoire
d&#8217;installation de la version de Java à utiliser.</p>
</div>
<div class="paragraph">
<p>Solution :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>trouver le répertoire d&#8217;installation de Java (choisir un JDK et non un JRE) (sous Windows, c&#8217;est souvent : <code>C:\Program Files\Java\jdk1.8</code>)</p>
</li>
<li>
<p>alimenter laes variables d&#8217;environnement avec ce répertoire.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_sous_windows_3">Sous Windows</h4>
<div class="ulist">
<ul>
<li>
<p>Dans la barre "rechercher", taper "environnement" et sélectionner "Modifier les variables d&#8217;environnement"</p>
</li>
<li>
<p>Choisir "Utilisateur" (bouton "Pour votre compte&#8230;&#8203;"),</p>
</li>
<li>
<p>Choisir "Nouvelle &#8230;&#8203;"</p>
</li>
<li>
<p>Nom de la variable : <code>JAVA_HOME</code>, et comme valeur le chemin d&#8217;installation de Java</p>
</li>
<li>
<p>Faire pareil pour la variable <code>JRE_HOME</code></p>
</li>
<li>
<p>A ce stde les variables sont positionnées, <strong>MAIS</strong> il faut redémarrer la console ligne de commande pour qu&#8217;elles soient prises en compte</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-05-20 13:53:36 +0200
</div>
</div>
</body>
</html>